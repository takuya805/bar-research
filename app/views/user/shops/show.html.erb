<div class="mypage page-top">
<% if user_signed_in? %>
<%= render 'user/users/sidebar', user: @user %>
<% end %>
<div class="shoptop" style="margin:0 auto;">
<% if user_signed_in? %>
<nav class="mb-2" style="height:30px;">
   <%= link_to 'Home', user_path(current_user.id) %><span class="mr-3 ml-3">/</span><%= link_to 'Bar Search', shops_search_path %><span class="mr-3 ml-3">/</span><%= link_to 'Bar一覧', shops_path %><span class="mr-3 ml-3">/</span><%= link_to @shop.name, shop_path(@shop.id) %>
</nav>
<% end %>
<main class="shopshow">
  <% if @review.errors.any? %>
    <div class="notification">
      <h2><%= @review.errors.count %>件のエラーがあります。</h2>
      <ul>
        <% @review.errors.full_messages.each do |message| %>
        <li><%= message %></li>
        <% end %>
      </ul>
    </div>
    <% end %>
<h4><%= @shop.name %></h4>
<span class=bookmark><div id="bookmarks_buttons_<%=@shop.id %>" style="text-align:right; padding-right:20px;">
  <%= render partial: 'user/bookmarks/bookmark', locals: {shop: @shop} %>
</div>
</span>
<p>【<%= @shop.category.category %>】</p>
<p><%= @shop.explain %></p>
<div class="infomartion">
  <table class="table">
    <tr>
      <td class="info">最寄り駅</td><td><%= @shop.station %></td>
    </tr>
    <tr>
      <td class="info">住所</td><td><%= @shop.postcode %><%= @shop.address %></td>
    </tr>
    <tr>
      <td class="info">電話番号</td><td><%= @shop.phone %></td>
    </tr>
    <tr>
      <td class="info">営業時間</td><td><%= @shop.open_time %>~<%= @shop.close_time %></td>
    </tr>
    <tr>
      <td class="info">定休日</td><td><%= @shop.holiday %></td>
    </tr>
    <tr>
      <td class="info">予算目安</td><td>¥<%= @shop.budget %></td>
    </tr>
    <tr>
      <td class="info">客席数</td><td><%= @shop.seat %>席</td>
    </tr>
      <% if @shop.hplink.present? %>
      <tr>
      <td class="info">ホームページ</td><td><%= @shop.hplink %></td>
      </tr>
      <% end %>
      <% if @shop.booking == true %>
      <tr class="book">
        <td class="info">備考</td><td>予約可</td>
      <% else %>
        <td class="info">備考</td><td>予約不可</td>
      </tr>
      <% end %>
  </table>

</div>



<script type="text/javascript">
  function initMap() {
<% #latitude,longitudeから位置を特定 %>
    var test ={lat: <%= @shop.latitude %>, lng: <%= @shop.longitude %>};
    var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 15,
              center: test
              });
    var transitLayer = new google.maps.TransitLayer();
    transitLayer.setMap(map);

    var contentString = '住所：<%= @shop.address %>';
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });

 <% #Map上の指定した位置にピンを挿して表示する %>
    var marker = new google.maps.Marker({
                  position:test,
                  map: map,
                  title: contentString
                 });

     marker.addListener('click', function() {
       infowindow.open(map, marker);
     });
  }
</script>

<!--#以下の記述の中にあるYOUR_API_KEYには取得したご自身のAPIキーを記述してください-->
<script async defer
              src="https://maps.googleapis.com/maps/api/js?v=3.exp&key= <%= ENV['API_KEY'] %>&callback=initMap">
</script>
 <!--表示するmapのcssです。ご自身でカスタマイズしてください。高さが設定されていないと表示されないことがあります。-->
<style class= "mb-5" type="text/css">
  #map { height: 500px;
         width: 80%;}
</style>

<% #mapの表示 %>
<div id="map"></div>
<% if user_signed_in? %>
<div class="new-review">
<div class="review-index">
 <h4 class="review-title">レビュー一覧</h4>
<% @reviews.each do |review| %>
<div class="review-view">
  <div class="review-new" style="width:75%;">
    <h5 style="font-weight:bold;">”<%= review.title %>”</h5>
    <% if review.image.present? %>
     <div><%= attachment_image_tag(review, :image, size: '100x100') %></div>
    <% end %>
    <div style="display:flex;">
      <%= link_to user_path(review.user), style: "color:black;" do %>
         <%= review.user.name %>さん&emsp;
           <% end %>
          <% unless review.user_id == current_user.id %>
         <span id="relationships_buttons_<%= review.user.id %>">
          <%= render partial: 'user/relationships/relationship', locals: {review: review} %>
         </span>
      <% end %>
    </div>
      <div id="star-rate-<%= review.id %>" style="display:inline-block;"></div><span class="star-count ml-1"><%= review.star %></span><span class="review-month" style="margin-left:20px;"><%= review.created_at.strftime('%Y/%m/%d') %>に投稿</span>
      <div><%= review.post %></div>
      <%= render 'user/reviews/star', review: review %>
  </div>
    <% if current_user == review.user %>
    <div class="review-delete mt-3" >
      <%= link_to '削除する', shop_review_path(id: review.id, shop_id: review.shop_id, user_id: current_user.id), method: :delete, "data-confirm" => "本当に削除しますか？", class: "btn-sm btn-danger" %>
    </div>
    <% end %>
    <% unless review.user_id == current_user.id %>
    <div class="review-favorite">
    <div id="favorites_buttons_<%= review.id %>">
      <%= render partial: 'user/favorites/favorite', locals: {review: review} %>
    </div>
    <div>
      <%= link_to chat_path(review.user), style: "color: black;", "data-turbolinks": false do %>
        <span style="color:#17A2B8; font-weight: bold;"><i class="fas fa-sms"></i><%= review.user.name %>さんに<br />チャットで聞く</span>
      <% end %>
    </div>
    </div>
    <% end %>
</div>
<% end %>
</div>
<% end %>

<% if user_signed_in? %>
<div class="new-review">
 <h4 class="review-title">レビュー投稿</h4>
  <div class="review-form">

    <%= render 'user/reviews/review', review: @review, shop: @shop %>
  </div>
  </div>
  </div>
</div>
 <div class="row">
    <div class="col">
      <div>
       <%= paginate @reviews, style: "color:black;" %>
      </div>
    </div>
  </div>
<% end %>
</main>
</div>
</div>
